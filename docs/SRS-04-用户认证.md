# 学习管理系统 - 用户与认证模块需求规格

## 文档信息

| 项目 | 内容 |
|-----|------|
| 文档名称 | 用户与认证模块 - 详细规格 |
| 版本 | v1.0 |
| 状态 | 已确认 |
| 所属模块 | 模块四 |

---

## 目录

1. [功能概述](#1-功能概述)
2. [用户界面](#2-用户界面)
3. [API 接口](#3-api-接口)
4. [数据模型](#4-数据模型)
5. [业务规则](#5-业务规则)

---

## 1. 功能概述

### 1.1 模块目标

提供用户注册登录、权限管理、部门管理等功能，支持管理员对用户和部门的增删改查操作。

### 1.2 核心功能清单

| 功能 | 优先级 | 描述 |
|-----|-------|------|
| 用户登录 | P0 | 用户登录系统 |
| 用户登出 | P0 | 用户退出系统 |
| 会话管理 | P0 | JWT Token 认证 |
| 用户列表 | P0 | 查看所有用户 |
| 创建用户 | P0 | 新增用户 |
| 编辑用户 | P1 | 修改用户信息 |
| 删除/禁用用户 | P1 | 管理用户状态 |
| 部门列表 | P0 | 查看所有部门 |
| 创建部门 | P0 | 新增部门 |
| 编辑部门 | P1 | 修改部门信息 |
| 删除部门 | P1 | 删除部门 |
| 部门人员调整 | P1 | 部门人员增删 |

### 1.3 优先级说明

| 优先级 | 说明 |
|-------|------|
| P0 | 核心功能，必须实现 |
| P1 | 重要功能，应该实现 |

---

## 2. 用户界面

### 2.1 登录页面

**页面路径**：`/auth/login`

**页面布局**：

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                      │
│                                                                      │
│              ┌─────────────────────────────────────┐                │
│              │         学习管理系统                 │                │
│              └─────────────────────────────────────┘                │
│                                                                      │
│              ┌─────────────────────────────────────┐                │
│              │  用户名 *                          │                │
│              │  ┌─────────────────────────────┐   │                │
│              │  │                             │   │                │
│              │  └─────────────────────────────┘   │                │
│              │                                     │                │
│              │  密码 *                            │                │
│              │  ┌─────────────────────────────┐   │                │
│              │  │                             │   │                │
│              │  └─────────────────────────────┘   │                │
│              │                                     │                │
│              │  [ 登录 ]                           │                │
│              │                                     │                │
│              └─────────────────────────────────────┘                │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 2.2 用户列表页面

**页面路径**：`/admin/users`

**页面布局**：

```
┌─────────────────────────────────────────────────────────────────────┐
│  用户管理                                                            │
├─────────────────────────────────────────────────────────────────────┤
│  [新建用户]                                                          │
├─────────────────────────────────────────────────────────────────────┤
│  [搜索用户名...]    [角色 ▼]    [部门 ▼]    [状态 ▼]  [筛选]       │
├─────────────────────────────────────────────────────────────────────┤
│  ┌──────┬──────────┬──────────┬──────────┬──────────┬──────────┐ │
│  │ 头像  │ 用户名   │ 姓名     │ 角色     │ 部门     │ 状态 │操作│ │
│  ├──────┼──────────┼──────────┼──────────┼──────────┼──────────┤ │
│  │ 👤   │ admin    │ 系统管理员 │ 管理员   │ -        │ 启用  编辑│ │
│  │      │           │          │          │          │       删除│ │
│  ├──────┼──────────┼──────────┼──────────┼──────────┼──────────┤ │
│  │ 👤   │ zhangsan │ 张三     │ 员工     │ 技术部   │ 启用  ... │ │
│  └──────┴──────────┴──────────┴──────────┴──────────┴──────────┘ │
├─────────────────────────────────────────────────────────────────────┤
│  [首页] [上一页] 1 2 3 [下一页] [末页]                        共 50 条 │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 2.3 用户创建/编辑对话框

```
┌─────────────────────────────────────────────────────────────────────┐
│                        创建用户                                      │
├─────────────────────────────────────────────────────────────────────┤
│  用户名 *                                                          │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                                                             │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                      │
│  姓名 *                                                            │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                                                             │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                      │
│  密码 *                                                            │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                                                             │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                      │
│  角色 *                                                            │
│  ┌────────────────────────────┐                                  │
│  │ ○ 管理员                   │                                  │
│  │ ● 员工                     │                                  │
│  │ ○ 部门主管                 │                                  │
│  └────────────────────────────┘                                  │
│                                                                      │
│  部门                                                              │
│  ┌────────────────────────────┐                                  │
│  │ 请选择部门 ▼               │                                  │
│  └────────────────────────────┘                                  │
│                                                                      │
│  [ 取消 ]                            [ 创建 ]                       │
└─────────────────────────────────────────────────────────────────────┘
```

---

### 2.4 部门列表页面

**页面路径**：`/admin/departments`

**页面布局**：

```
┌─────────────────────────────────────────────────────────────────────┐
│  部门管理                                                            │
├─────────────────────────────────────────────────────────────────────┤
│  [新建部门]                                                          │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │  部门名称          │ 部门人数  │ 负责人  │ 操作              │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ☑ 技术部          │ 15        │ 张三    │ [编辑] [删除]    │ │
│  │    ├─ 研发组      │ 8         │ 李四    │ [编辑] [删除]    │ │
│  │    └─ 测试组      │ 7         │ 王五    │ [编辑] [删除]    │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ☑ 市场部          │ 10        │ 赵六    │ [编辑] [删除]    │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 3. API 接口

### 3.1 认证接口

#### 3.1.1 用户登录

**接口**：`POST /api/auth/login`

**请求体**：`{"username": "admin", "password": "admin123"}`

**响应**：
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "user-uuid",
      "username": "admin",
      "name": "系统管理员",
      "role": "admin",
      "department_id": null
    }
  }
}
```

#### 3.1.2 用户登出

**接口**：`POST /api/auth/logout`

#### 3.1.3 获取当前用户

**接口**：`GET /api/auth/me`

---

### 3.2 用户管理接口

| 接口 | 方法 | 路径 | 描述 |
|-----|------|------|------|
| 获取用户列表 | GET | /api/users | 分页、筛选 |
| 创建用户 | POST | /api/users | 新增用户 |
| 获取用户详情 | GET | /api/users/[id] | 用户详情 |
| 更新用户 | PUT | /api/users/[id] | 更新用户 |
| 删除用户 | DELETE | /api/users/[id] | 删除用户 |

---

### 3.3 部门管理接口

| 接口 | 方法 | 路径 | 描述 |
|-----|------|------|------|
| 获取部门列表 | GET | /api/departments | 树形结构 |
| 创建部门 | POST | /api/departments | 新增部门 |
| 获取部门详情 | GET | /api/departments/[id] | 包含成员 |
| 更新部门 | PUT | /api/departments/[id] | 更新部门 |
| 删除部门 | DELETE | /api/departments/[id] | 删除部门 |
| 获取部门成员 | GET | /api/departments/[id]/users | 成员列表 |
| 添加成员 | POST | /api/departments/[id]/users | 添加成员 |
| 移除成员 | DELETE | /api/departments/[id]/users | 移除成员 |

---

## 4. 数据模型

### 4.1 users 表

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  name VARCHAR(100) NOT NULL,
  role VARCHAR(20) NOT NULL DEFAULT 'user',
  department_id UUID REFERENCES departments(id),
  status VARCHAR(20) NOT NULL DEFAULT 'active',
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP
);
```

### 4.2 departments 表

```sql
CREATE TABLE departments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  description TEXT,
  parent_id UUID REFERENCES departments(id) ON DELETE SET NULL,
  leader_id UUID REFERENCES users(id) ON DELETE SET NULL,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP
);
```

---

## 5. 业务规则

### 5.1 权限矩阵

| 功能 | 管理员 | 部门主管 | 员工 |
|-----|-------|---------|------|
| 用户登录/登出 | ✅ | ✅ | ✅ |
| 查看用户列表 | ✅ | 仅本部门 | ❌ |
| 创建用户 | ✅ | ❌ | ❌ |
| 编辑用户 | ✅ | 仅本部门 | 仅本人 |
| 删除用户 | ✅ | ❌ | ❌ |
| 部门管理 | ✅ | ❌ | ❌ |
| 部门人员调整 | ✅ | ✅ | ❌ |

### 5.2 用户规则

| 规则 | 说明 |
|-----|------|
| 用户名唯一 | 4-50字符，字母数字下划线 |
| 密码要求 | 最少6位 |
| 初始角色 | 默认"员工" |
| 登录锁定 | 连续失败5次锁定30分钟 |

---

## 附录

### 相关文档

| 文档名称 | 描述 |
|---------|------|
| SRS-01-总体规格.md | 项目总体规格文档 |
| SRS-02-任务管理.md | 任务管理模块详细规格 |
| SRS-03-学习追踪.md | 学习追踪模块详细规格 |
| SRS-05-测验考核.md | 测验考核模块详细规格 |
| SRS-06-报表统计.md | 报表统计模块详细规格 |
| UI-DESIGN.md | UI/UX 设计规范 |
