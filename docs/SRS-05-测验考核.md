# 学习管理系统 - 测验考核模块需求规格

## 文档信息

| 项目 | 内容 |
|-----|------|
| 文档名称 | 测验考核模块 - 详细规格 |
| 版本 | v1.0 |
| 状态 | 已确认 |
| 所属模块 | 模块五 |

---

## 目录

1. [功能概述](#1-功能概述)
2. [用户界面](#2-用户界面)
3. [API 接口](#3-api-接口)
4. [数据模型](#4-数据模型)
5. [业务规则](#5-业务规则)

---

## 1. 功能概述

### 1.1 模块目标

为学习任务添加测验考核功能，检验员工学习效果，支持单选题目、自动评分和及格判定。

### 1.2 核心功能清单

| 功能 | 优先级 | 描述 |
|-----|-------|------|
| 测验题目管理 | P1 | 添加/编辑/删除测验题目 |
| 答题页面 | P1 | 测验答题界面 |
| 提交测验 | P1 | 提交答案 |
| 自动评分 | P1 | 自动计算分数 |
| 及格判定 | P1 | 根据规则判定是否及格 |
| 重考限制 | P1 | 限制测验提交次数 |

---

## 2. 用户界面

### 2.1 测验答题页面

**页面路径**：`/tasks/[id]/quiz`

**页面布局**：

```
┌─────────────────────────────────────────────────────────────────────┐
│  [返回]  新员工入职培训 - 测验考核                                    │
├─────────────────────────────────────────────────────────────────────┤
│  测验信息                                                            │
│  ───────────────────────────────────────────────────────────────    │
│  总题量：5 题  │  及格分数：60 分  │  剩余次数：3 次              │
│  测验规则：达到及格分数即可通过（未开启严格模式）                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  1. 公司成立于哪一年？                                               │
│  ─────────────────────────────────────────────────────────────    │
│  ○ A. 2010 年                                                      │
│  ● B. 2015 年                                                      │
│  ○ C. 2018 年                                                      │
│  ○ D. 2020 年                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  2. 公司的核心价值观是？                                              │
│  ─────────────────────────────────────────────────────────────    │
│  ○ A. 创新、协作、诚信                                              │
│  ○ B. 效率第一                                                      │
│  ○ C. 利润最大化                                                    │
│  ○ D. 不清楚                                                        │
├─────────────────────────────────────────────────────────────────────┤
│  ...（第3-5题）                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  [ 提交测验 ]                                                        │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 测验结果页面

```
┌─────────────────────────────────────────────────────────────────────┐
│  测验结果                                                            │
├─────────────────────────────────────────────────────────────────────┤
│                        ┌─────────────────────┐                     │
│                        │        85 分       │                     │
│                        │                    │                     │
│                        │       ✅ 通过       │                     │
│                        └─────────────────────┘                     │
├─────────────────────────────────────────────────────────────────────┤
│  测验统计                                                            │
│  ───────────────────────────────────────────────────────────────    │
│  总题量：5 题  │  正确：4 题  │  错误：1 题                       │
│  用时：5 分 30 秒                                                   │
├─────────────────────────────────────────────────────────────────────┤
│  答题详情                                                            │
│  ───────────────────────────────────────────────────────────────    │
│  1. ✅ 公司成立于哪一年？                                            │
│     你的答案：B. 2015 年  │  正确答案：B. 2015 年                   │
│                                                                      │
│  2. ❌ 公司的核心价值观是？                                           │
│     你的答案：B. 效率第一  │  正确答案：A. 创新、协作、诚信         │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  [ 返回学习页面 ]         [ 再测一次 ]                              │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 3. API 接口

### 3.1 测验管理

| 接口 | 方法 | 描述 |
|-----|------|------|
| GET /api/tasks/[id]/quiz | 获取测验信息 |
| POST /api/tasks/[id]/quiz | 添加题目 |
| PUT /api/tasks/[id]/quiz/[questionId] | 更新题目 |
| DELETE /api/tasks/[id]/quiz/[questionId] | 删除题目 |

### 3.2 测验提交

| 接口 | 方法 | 描述 |
|-----|------|------|
| POST /api/quiz/submit | 提交测验答案 |
| GET /api/quiz/[taskId]/result | 获取测验结果 |

---

## 4. 数据模型

### 4.1 quiz_questions 表

```sql
CREATE TABLE quiz_questions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
  question TEXT NOT NULL,
  options JSONB NOT NULL,
  correct_answer INT NOT NULL,
  "order" INT NOT NULL DEFAULT 0,
  created_at TIMESTAMP NOT NULL DEFAULT NOW()
);
```

### 4.2 quiz_submissions 表

```sql
CREATE TABLE quiz_submissions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  score DECIMAL(5,2) NOT NULL,
  passed BOOLEAN NOT NULL,
  total_questions INT NOT NULL,
  correct_answers INT NOT NULL,
  attempt_count INT NOT NULL DEFAULT 1,
  answers JSONB NOT NULL,
  submitted_at TIMESTAMP NOT NULL DEFAULT NOW()
);
```

---

## 5. 业务规则

### 5.1 及格判定

| strict_mode | 及格条件 |
|------------|---------|
| FALSE（默认） | score >= passing_score |
| TRUE | score == 100 |

### 5.2 提交限制

| 规则 | 说明 |
|-----|------|
| 最大次数 | 同一任务最多 3 次 |
| 及格后 | 无需再次提交 |
| 次数用完 | 返回错误"提交次数已用完" |

---

## 附录

| 文档名称 | 描述 |
|---------|------|
| SRS-01-总体规格.md | 项目总体规格 |
| SRS-02-任务管理.md | 任务管理模块 |
| SRS-03-学习追踪.md | 学习追踪模块 |
| SRS-04-用户认证.md | 用户与认证模块 |
| SRS-06-报表统计.md | 报表统计模块 |
| UI-DESIGN.md | UI/UX 设计规范 |
